<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.TbDeviceMapper">

    <resultMap type="TbDevice" id="TbDeviceResult">
        <result property="id"    column="id"    />
        <result property="deviceName"    column="device_name"    />
        <result property="deviceType"    column="device_type"    />
        <result property="serialNumber"    column="serial_number"    />
        <result property="serialNumber1"    column="serialNumber1"    />
        <result property="function1"    column="function1"    />
        <result property="measure"    column="measure"    />
        <result property="purchaseDate"    column="purchase_date"    />
        <result property="warrantyExp"    column="warranty_exp"    />
        <result property="status"    column="status"    />
        <result property="location"    column="location"    />
        <result property="remarks"    column="remarks"    />
        <result property="temperature"    column="temperature"    />
        <result property="roomId"    column="room_id"    />
        <result property="humidity"    column="humidity"    />
        <result property="pressure"    column="pressure"    />
    </resultMap>

    <sql id="selectTbDeviceVo">
        SELECT
            td.id,
            device_name,
            device_type,
            td.serial_number,
            purchase_date,
            warranty_exp,
            STATUS,
            location,
            remarks,
            temperature,
            td.room_id,
            humidity,
            pressure,
            con.serial_number AS serialNumber1,
            con.function1 AS function1,
            sen.measure AS measure
        FROM
            tb_device td
                LEFT JOIN CONNECTION con ON td.id = con.device_id
                LEFT JOIN sensor sen ON con.sensor_id = sen.sensor_id
    </sql>

    <select id="selectTbDeviceList" parameterType="TbDevice" resultMap="TbDeviceResult">
        <include refid="selectTbDeviceVo"/>
        <where>
            <if test="deviceName != null  and deviceName != ''"> and device_name like concat('%', #{deviceName}, '%')</if>
            <if test="deviceType != null  and deviceType != ''"> and device_type = #{deviceType}</if>
            <if test="serialNumber != null  and serialNumber != ''"> and serial_number = #{serialNumber}</if>
            <if test="purchaseDate != null "> and purchase_date = #{purchaseDate}</if>
            <if test="warrantyExp != null "> and warranty_exp = #{warrantyExp}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="location != null  and location != ''"> and location = #{location}</if>
            <if test="remarks != null  and remarks != ''"> and remarks = #{remarks}</if>
            <if test="temperature != null  and temperature != ''"> and temperature = #{temperature}</if>
            <if test="roomId != null "> and room_id = #{roomId}</if>
            <if test="humidity != null  and humidity != ''"> and humidity = #{humidity}</if>
            <if test="pressure != null  and pressure != ''"> and pressure = #{pressure}</if>
        </where>
    </select>

    <select id="selectTbDeviceById" parameterType="Long" resultMap="TbDeviceResult">
        <include refid="selectTbDeviceVo"/>
        where id = #{id}
    </select>

    <insert id="insertTbDevice" parameterType="TbDevice" useGeneratedKeys="true" keyProperty="id">
        insert into tb_device
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="deviceName != null">device_name,</if>
            <if test="deviceType != null">device_type,</if>
            <if test="serialNumber != null">serial_number,</if>
            <if test="purchaseDate != null">purchase_date,</if>
            <if test="warrantyExp != null">warranty_exp,</if>
            <if test="status != null">status,</if>
            <if test="location != null">location,</if>
            <if test="remarks != null">remarks,</if>
            <if test="temperature != null">temperature,</if>
            <if test="roomId != null">room_id,</if>
            <if test="humidity != null">humidity,</if>
            <if test="pressure != null">pressure,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="deviceName != null">#{deviceName},</if>
            <if test="deviceType != null">#{deviceType},</if>
            <if test="serialNumber != null">#{serialNumber},</if>
            <if test="purchaseDate != null">#{purchaseDate},</if>
            <if test="warrantyExp != null">#{warrantyExp},</if>
            <if test="status != null">#{status},</if>
            <if test="location != null">#{location},</if>
            <if test="remarks != null">#{remarks},</if>
            <if test="temperature != null">#{temperature},</if>
            <if test="roomId != null">#{roomId},</if>
            <if test="humidity != null">#{humidity},</if>
            <if test="pressure != null">#{pressure},</if>
        </trim>
    </insert>

    <update id="updateTbDevice" parameterType="TbDevice">
        update tb_device
        <trim prefix="SET" suffixOverrides=",">
            <if test="deviceName != null">device_name = #{deviceName},</if>
            <if test="deviceType != null">device_type = #{deviceType},</if>
            <if test="serialNumber != null">serial_number = #{serialNumber},</if>
            <if test="purchaseDate != null">purchase_date = #{purchaseDate},</if>
            <if test="warrantyExp != null">warranty_exp = #{warrantyExp},</if>
            <if test="status != null">status = #{status},</if>
            <if test="location != null">location = #{location},</if>
            <if test="remarks != null">remarks = #{remarks},</if>
            <if test="temperature != null">temperature = #{temperature},</if>
            <if test="roomId != null">room_id = #{roomId},</if>
            <if test="humidity != null">humidity = #{humidity},</if>
            <if test="pressure != null">pressure = #{pressure},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteTbDeviceById" parameterType="Long">
        delete from tb_device where id = #{id}
    </delete>

    <delete id="deleteTbDeviceByIds" parameterType="String">
        delete from tb_device where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <select id="getDeviceType" parameterType="Long" resultMap="TbDeviceResult">
        select device_type ,count(1) as count from tb_device group by device_type
    </select>
    <select id="getDeviceStatus" parameterType="Long" resultMap="TbDeviceResult">
        select device_name ,status from tb_device group by device_name,status
    </select>
</mapper>
